<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebGL</title>
    <script src="TEntidades.js"></script>
    <script src="TNodo.js"></script>
    <script src="TGestorRecursos.js"></script>
    <script src="TRecurso.js"></script>
    <script src="TRecursoMalla.js"></script>
    <script src="TRecursoMaterial.js"></script>
    <script src="TRecursoTextura.js"></script>
    <script src="TRecursoShader.js"></script>
    <script src="TMotor.js"></script>
    <script src="content/utilities.js"></script>
    <link rel="stylesheet" type="text/css" href="estilo.css">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>

    <!--IMPORTACIÓN DESDE EL CDN <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.4.0/gl-matrix.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.4.0/gl-matrix-min.js"></script>-->
    <!--IMPORTACIÓN DESDE ARCHIVOS
    <script src="content/gl-matrix-min.js"></script>-->

    <script src="content/gl-matrix.js"></script>


</head>
<body>

    <canvas id="my-canvas" width="600" height="450">
        Tu navegador no soporta el elemento canvas de HTML5.
    </canvas>

    <button onclick="motor.stopDrawing()">Pausa</button>
    <button onclick="motor.startDrawing()">Continuar</button>

    <script>
        var canvas=null;

        var frames, fpsInterval, startTime, now, then, elapsed, frameCount;

        var texturas=0;


        //Inicializamos la pila de matriz y la matriz modelo
        var matrixStack=[];
        var matrixModel = mat4.create();
        matrixStack.push(matrixModel);
        var matrixProjection=[];
        var invertedMView;

        //inicializamos vector de texturas
        var textureImage=[];
        //variable que tendrá el programa webgl
        var gl=null;


        //inicializamos el gestor de recursos
        var gestor=new TGestorRecursos();

        iniciamosWebGL('my-canvas');
        configurarShaders('shaderP.vs', 'shaderP.fs');

        //fachada
        var motor = new TMotor(gestor);

        var luz = motor.crearNodoLuz("luz1", 1.7, undefined);
        //var luz2 = motor.crearNodoLuz("luz2", 0.7, undefined);
        //var luz3 = motor.crearNodoLuz("luz3", 0.7, undefined);

        var camara = motor.crearNodoCamara("camara1", true, undefined);


        var suelo=motor.crearNodoMalla("suelo", "cubo");

        var malla2 = motor.crearNodoMalla("malla2", "Susan", undefined);

        var malla3 = motor.crearNodoMalla("malla3", "bote", undefined);

        //var malla4=motor.crearNodoMalla("malla4", "perejil", undefined);

        motor.escalarMalla("malla4", 0.2);



        motor.escalarMallaxyz("suelo", 20, 0, 20);
        //suelo.dad.entity.escalar(100, 0, 100);
        motor.moverMalla("suelo", 0, -15, 0);

        //motor.moverMalla("malla1", -9, -15, -30);

        motor.escalarMalla("malla2", 6);
        motor.moverMalla("malla2", 0, 0, -20);

        motor.moverMalla("malla3", 15, 10, 0);
        motor.escalarMalla("malla3", 6);
        motor.rotarMalla("malla3", 40, "x");

        //motor.escalarMalla("malla2", 5)

        //motor.moverMalla("malla3", 0, 0, -7);   

        motor.moverLuz("luz1", 0.0, 80.0, 0.0);   
        //motor.moverLuz("luz2", 0.0, 10.0, 0.0);  
        //motor.moverLuz("luz3", 0.0, -10.0, 0.0);  


        //motor.rotarMalla("malla2", 180, "z");

        //motor.rotarMalla("malla2", 180, "y");  
        //motor.rotarMalla("malla2", 90, "x"); 
        //motor.rotarMalla("malla1", 10, "x");

        //motor.escalarMalla("malla2", 0.3);


        motor.moverCamara("camara1", 0, 0, 30);
        //motor.rotarCamara("camara1", 180, "y");

        motor.activarCamara("camara1");

        motor.activarLuz("luz1");
        //motor.activarLuz("luz2");
        //motor.activarLuz("luz3");

        /*

        //plantas
        motor.crearNodoMalla("maceta1", "maceta", undefined);
        motor.crearNodoMalla("maceta2", "maceta", undefined);
        for(let i=0; i<6; i++){
            for(let j=0; j<4; j++){
                motor.crearNodoMalla("calabaza"+i+"-"+j, "calabaza", undefined);
                motor.escalarMalla("calabaza"+i+"-"+j, 3, 3, 3);
                motor.moverMalla("calabaza"+i+"-"+j, -30+(i*10), -15, -20+(j*10));

            }
        }
 

        motor.moverMalla("maceta1", 6, -18, -35);
        motor.moverMalla("maceta2", -10, -18, -35);

        



        
        */





        //console.log(motor.escena);





        //declaramos las variables necesarias para ejecutar el programa
        //las variables de WebGL empezarán siempre por gl para distinguirlas de
        //las variables del motor gráfico 
        var glVertexShader=null, glFragmentShader=null, glProgram=null;


            motor.startDrawing('shaderPhong+Shadow.vs', 'shaderPhong+Shadow.fs');








        $(document).keydown(function(evt){
            console.log(evt.keyCode);
            switch(evt.keyCode){
                case 83: //down
                    motor.moverCamara("camara1", 0, -0.5, 0);
                    break;
                case 87: //up
                    motor.moverCamara("camara1", 0, 0.5, 0);
                    break;
                case 65: //left
                    motor.moverCamara("camara1", -0.5, 0, 0);
                    break;
                case 68: //right
                    motor.moverCamara("camara1", 0.5, 0, 0);
                    break;
                case 40: //down
                    motor.rotarCamara("camara1", 2, "x");
                    break;
                case 38: //up
                    motor.rotarCamara("camara1", -2, "x");
                    break;
                case 37: //left
                    motor.rotarCamara("camara1", 2, "y");
                    break;
                case 39: //right
                    motor.rotarCamara("camara1", -2, "y");
                    break;
                default:

                    break;
                }
            });
    </script>
</body>
</html>
